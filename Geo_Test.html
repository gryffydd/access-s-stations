<!DOCTYPE html>
<html>
<head>
    <title>GeoJSON Example - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>

    <style>
            html, body {
                height: 100%;
                margin: 0;
            }
            #map {
                width: 1000px;
                height: 800px;
            }
    </style>

    <script>
        function make_array (low, high, step) {
            a = [];
            for (x = low * 100; x <= high * 100 ; x += step * 100) {
                a.push(x / 100);
            }
            return a;
        }

        var lat = make_array(-44.5, -10.0, 0.05);
        var lon = make_array(112.0, 156.25, 0.05);

        function make_point (x, y) {
            var content = "Lat: " + lat[y] + " - Lon: " + lon[x] + " - Index (x, y): (" + x + ", " + y + ")";
            var href = "http://opendap.bom.gov.au:8080/thredds/dodsC/seasonal_prediction/access-s/atmos/pr/e01/w_daq5_pr_20190816_e01.nc.ascii?pr[0:1:19][" + y + ":1:" + y + "][" + x + ":1:" + x + "]";
            content = "<a href=\"" + href + "\" target=\"opendap_" + x + "_" + y + "\">" + content + "</a>";
            p = {};
            p.type = "Feature";
            p.properties = {"content": content};
            p.geometry = {"type": "Point", "coordinates": [lon[x], lat[y]]};
                return p;
        }

        function make_collection () {
            var feature_array = [];

            for (x = 0; x < lon.length; x += 20) {
                for (y = 10; y < lat.length; y += 20) {
                    feature_array.push(make_point (x, y));
                }
            }

            c = {};
            c.type = "FeatureCollection";
            c.features = feature_array;

            return c;
        };

        var fc = make_collection();
	</script>

</head>
<body>
    <div id='map'></div>

    <script>
        // Center on Melbourne
        var map = L.map('map').setView([-38, 145], 6);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw',
            {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                    '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox.light'
            }).addTo(map);

        function onEachFeature(feature, layer) {
            var popupContent = "Unset";
            if (feature.properties && feature.properties.content) {
                popupContent = feature.properties.content;
            }
            layer.bindPopup(popupContent);
        }

        L.geoJSON(fc, {
                onEachFeature: onEachFeature,
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, {
                        radius: 8,
                        fillColor: "#00FFFF",
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.25
                });
            }
        }).addTo(map);

    </script>
</body>
</html>
